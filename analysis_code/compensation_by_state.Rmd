---
title: "Compensation_by_state"
author: "Marina Chaji"
date: "2024-01-24"
output: html_document
---


Introduction 

This code will be used to explore the five key metrics of utility: number of trips, scallop revenue, landed pounds, operation profit, and revenue per day. All of which are calculated as averages per trip. The findings are used for discussion of compensation in the “Assessing Offshore Wind Development: A Comparative Analysis of Scallop Fishery Impacts throughout the Regulatory Process”  paper. Findings are also available in chunks throughout the scallop_tiny_report. We also consider areas excluded as regulatory processes occur using z-tests between phases, i.e., Call Area(s) to Wind Energy Area(s) and Wind Energy Area(s) to Lease Area(s) in the New York Bight (NY) & Central Atlantic (CA) regions. 

This code is very similar to the "case_study_comparisons.Rmd", except the it groups by fleet and VTR_STATE.

The .RDS datasets loaded in the "load_in_data" chunk are generated by running the "knit_tiny_scallop_analysis_loop.R" with the following options: 


```{r pre, eval=FALSE}

AADAS_Vals_to_loop<-c(TRUE,FALSE) 
input_shapefile_vals_to_loop2<-c("wind_NY1.RDS","wind_NY2.RDS","wind_NY3.RDS","wind_Central_Atlantic_1.RDS", "wind_Central_Atlantic_2.RDS","wind_Central_Atlantic_3.RDS")

```

```{r}
library(dplyr)
```








```{r load_in_data}

#Load GCIFQ data 

NY1_GC <- readRDS(here::here("data","main","casestudies","casestudy_gc_NY1_2023_11_06.Rds"))
NY2_GC <- readRDS(here::here("data","main","casestudies","casestudy_gc_NY2_2023_11_06.Rds"))
NY3_GC <- readRDS(here::here("data","main","casestudies","casestudy_gc_NY3_2023_11_06.Rds"))

CA1_GC <- readRDS(here::here("data","main","casestudies","casestudy_gc_CA1_2023_11_06.Rds"))
CA2_GC <- readRDS(here::here("data","main","casestudies","casestudy_gc_CA2_2023_11_06.Rds"))
CA3_GC <- readRDS(here::here("data","main","casestudies","casestudy_gc_CA3_2023_11_06.Rds"))



#Load LA data 


NY1_LA <- readRDS(here::here("data","main","casestudies","casestudy_LA_NY1_2023_11_06.Rds"))
NY2_LA <- readRDS(here::here("data","main","casestudies","casestudy_LA_NY2_2023_11_06.Rds"))
NY3_LA <- readRDS(here::here("data","main","casestudies","casestudy_LA_NY3_2023_11_06.Rds"))

CA1_LA <- readRDS(here::here("data","main","casestudies","casestudy_LA_CA1_2023_11_06.Rds"))
CA2_LA <- readRDS(here::here("data","main","casestudies","casestudy_LA_CA2_2023_11_06.Rds"))
CA3_LA <- readRDS(here::here("data","main","casestudies","casestudy_LA_CA3_2023_11_06.Rds"))

```


GC-IFQ data.  


```{r}

## New York Bight 

Inside_NY1_GC <- NY1_GC %>% filter(in_closure == "TRUE")

Inside_NY2_GC <- NY2_GC %>% filter(in_closure == "TRUE")

Inside_NY3_GC <- NY3_GC %>% filter(in_closure == "TRUE")


dropped_values_NY_1_2_GC <- anti_join(Inside_NY1_GC, Inside_NY2_GC, by = c("TRIPID" = "TRIPID"))

dropped_values_NY_2_3_GC <- anti_join(Inside_NY2_GC, Inside_NY3_GC, by = c("TRIPID" = "TRIPID"))



## Central Atlantic 

Inside_CA1_GC <- CA1_GC %>% filter(in_closure == "TRUE")

Inside_CA2_GC <- CA2_GC %>% filter(in_closure == "TRUE")

Inside_CA3_GC <- CA3_GC %>% filter(in_closure == "TRUE")


dropped_values_CA_1_2_GC <- anti_join(Inside_CA1_GC, Inside_CA2_GC, by = c("TRIPID" = "TRIPID"))

dropped_values_CA_2_3_GC <- anti_join(Inside_CA2_GC, Inside_CA3_GC, by = c("TRIPID" = "TRIPID"))

dropped_values_CA_1_3_GC <- anti_join(Inside_CA1_GC, Inside_CA3_GC, by = c("TRIPID" = "TRIPID"))


```

dropped_values_NY_1_2_GC contains observations for the GC fleet that are in the NYB Call Area (1), but not in the NYB Wind Energy Area (2).  dropped_values_NY_2_3_GC contains obsevations for the GC fleet that are in the NYB Wind Energy Area (2), but not in the NYB Lease Areas (3). Other "dropped_values" objects are named analogously.




Limited Access
```{r}

## New York Bight 

Inside_NY1_LA <- NY1_LA %>% filter(in_closure == "TRUE")

Inside_NY2_LA <- NY2_LA %>% filter(in_closure == "TRUE")

Inside_NY3_LA <- NY3_LA %>% filter(in_closure == "TRUE")


dropped_values_NY_1_2_LA <- anti_join(Inside_NY1_LA, Inside_NY2_LA, by = c("TRIPID" = "TRIPID"))

dropped_values_NY_2_3_LA <- anti_join(Inside_NY2_LA, Inside_NY3_LA, by = c("TRIPID" = "TRIPID"))



## Central Atlantic 

Inside_CA1_LA <- CA1_LA %>% filter(in_closure == "TRUE")

Inside_CA2_LA <- CA2_LA %>% filter(in_closure == "TRUE")

Inside_CA3_LA <- CA3_LA %>% filter(in_closure == "TRUE")


dropped_values_CA_1_2_LA <- anti_join(Inside_CA1_LA, Inside_CA2_LA, by = c("TRIPID" = "TRIPID"))

dropped_values_CA_2_3_LA <- anti_join(Inside_CA2_LA, Inside_CA3_LA, by = c("TRIPID" = "TRIPID"))

dropped_values_CA_1_3_LA <- anti_join(Inside_CA1_LA, Inside_CA3_LA, by = c("TRIPID" = "TRIPID"))

```

dropped_values_CA_1_2_LA contains observations for the LA fleet that are in the Central Atlantic Call Area (1), but not in the Draft Central Atlantic Wind Energy Area (2).  dropped_values_CA_1_3_LA contains obsevations for the LA  fleet that are in the Central Atlantic Call Area (1), but not in the Finalized Central Atlantic Wind Energy Area (3). Other "dropped_values" objects are named analogously.


```{r}

## New York Bight


 Inside_NY1_AA <- Inside_CA1_LA %>% filter(fleet == "Access Area") 
 Inside_CA1_DAS <- Inside_CA1_LA %>% filter(fleet == "Days at Sea") 
 
 Inside_NY2_AA <- Inside_CA2_LA %>% filter(fleet == "Access Area") 
 Inside_NY2_DAS <- Inside_CA2_LA %>% filter(fleet == "Days at Sea") 
 
 Inside_NY3_AA <- Inside_CA3_LA %>% filter(fleet == "Access Area") 
 Inside_NY3_DAS <- Inside_CA3_LA %>% filter(fleet == "Days at Sea") 
 
 
 dropped_values_NY_1_2_AA <- dropped_values_NY_1_2_LA %>% filter(fleet == "Access Area") 
 dropped_values_NY_1_2_DAS <- dropped_values_NY_1_2_LA %>% filter(fleet == "Days at Sea") 
 
 dropped_values_NY_2_3_AA <- dropped_values_NY_2_3_LA %>% filter(fleet == "Access Area") 
 dropped_values_NY_2_3_DAS <- dropped_values_NY_2_3_LA %>% filter(fleet == "Days at Sea") 

 
 dropped_values_NY_1_3_AA <- dropped_values_NY_1_2_LA %>% filter(fleet == "Access Area") 
 dropped_values_NY_1_3_DAS <- dropped_values_NY_1_2_LA %>% filter(fleet == "Days at Sea") 



## Central Atlantic


Inside_CA1_AA <- Inside_CA1_LA %>% filter(fleet == "Access Area") 
Inside_CA1_DAS <- Inside_CA1_LA %>% filter(fleet == "Days at Sea") 
 
Inside_CA2_AA <- Inside_CA2_LA %>% filter(fleet == "Access Area") 
Inside_CA2_DAS <- Inside_CA2_LA %>% filter(fleet == "Days at Sea") 
 
Inside_CA3_AA <- Inside_CA3_LA %>% filter(fleet == "Access Area") 
Inside_CA3_DAS <- Inside_CA3_LA %>% filter(fleet == "Days at Sea") 
 
 
dropped_values_CA_1_2_AA <- dropped_values_CA_1_2_LA %>% filter(fleet == "Access Area") 
dropped_values_CA_1_2_DAS <- dropped_values_CA_1_2_LA %>% filter(fleet == "Days at Sea") 
 
dropped_values_CA_2_3_AA <- dropped_values_CA_2_3_LA %>% filter(fleet == "Access Area") 
dropped_values_CA_2_3_DAS <- dropped_values_CA_2_3_LA %>% filter(fleet == "Days at Sea") 

dropped_values_CA_1_3_AA <- dropped_values_CA_1_3_LA %>% filter(fleet == "Access Area") 
dropped_values_CA_1_3_DAS <- dropped_values_CA_1_3_LA %>% filter(fleet == "Days at Sea") 

```



# Central Atlantic Section 


## Aggregate Scallop Revenue and Operating Profit CA1, CA2, and CA3 and the Dropped Values from 1-3 for the LA Fleet

```{r}
 Inside_CA1_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=sum(DOLLAR_2022_win),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))


Inside_CA2_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=sum(DOLLAR_2022_win),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))

Inside_CA3_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=sum(DOLLAR_2022_win),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))



dropped_values_CA_1_3_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=sum(DOLLAR_2022_win),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))

```



## Average Winsorized Revenue, VPUE, Operating Profit, and Landings in CA closures by fleet LA 

```{r}
Inside_CA1_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=mean(DOLLAR_2022_win),VPUE_win=mean(VPUE_win),
                   LANDED_win=mean(LANDED_win), OPERATING_win=mean(OPERATING_PROFIT_2022_win))


Inside_CA2_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=mean(DOLLAR_2022_win),VPUE_win=mean(VPUE_win),
                   LANDED_win=mean(LANDED_win), OPERATING_win=mean(OPERATING_PROFIT_2022_win))


Inside_CA3_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=mean(DOLLAR_2022_win),VPUE_win=mean(VPUE_win),
                   LANDED_win=mean(LANDED_win), OPERATING_win=mean(OPERATING_PROFIT_2022_win) )

dropped_values_CA_1_3_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=mean(DOLLAR_2022_win),VPUE_win=mean(VPUE_win),
                   LANDED_win=mean(LANDED_win), OPERATING_win=mean(OPERATING_PROFIT_2022_win) )


dropped_values_CA_1_2_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=mean(DOLLAR_2022_win),VPUE_win=mean(VPUE_win),
                   LANDED_win=mean(LANDED_win), OPERATING_win=mean(OPERATING_PROFIT_2022_win) )


dropped_values_CA_2_3_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=mean(DOLLAR_2022_win),VPUE_win=mean(VPUE_win),
                   LANDED_win=mean(LANDED_win), OPERATING_win=mean(OPERATING_PROFIT_2022_win) )


```

## Aggregate Scallop revenue CA1, CA2, and CA3 and the Dropped Values from 1-3 for the GCIFQ Fleet

```{r}


Inside_CA1_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022=sum(DOLLAR_2022),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))


Inside_CA2_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022=sum(DOLLAR_2022),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))

Inside_CA3_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022=sum(DOLLAR_2022),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))



dropped_values_CA_1_3_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022=sum(DOLLAR_2022),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))

```

##Average Winsorized Revenue, VPUE, Operating Profit, and Landed weights for the Central Atlantic, GCIFQ

```{r}

Inside_CA1_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=mean(DOLLAR_2022_win),VPUE_win=mean(VPUE_win),
                   LANDED_win=mean(LANDED_win), OPERATING_win=mean(OPERATING_PROFIT_2022_win) )


Inside_CA2_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=mean(DOLLAR_2022_win),VPUE_win=mean(VPUE_win),
                   LANDED_win=mean(LANDED_win), OPERATING_win=mean(OPERATING_PROFIT_2022_win) )


Inside_CA3_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=mean(DOLLAR_2022_win),VPUE_win=mean(VPUE_win),
                   LANDED_win=mean(LANDED_win), OPERATING_win=mean(OPERATING_PROFIT_2022_win) )



dropped_values_CA_1_3_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=mean(DOLLAR_2022_win),VPUE_win=mean(VPUE_win),
                   LANDED_win=mean(LANDED_win), OPERATING_win=mean(OPERATING_PROFIT_2022_win) )


dropped_values_CA_1_2_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=mean(DOLLAR_2022_win),VPUE_win=mean(VPUE_win),
                   LANDED_win=mean(LANDED_win), OPERATING_win=mean(OPERATING_PROFIT_2022_win) )


dropped_values_CA_2_3_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=mean(DOLLAR_2022_win),VPUE_win=mean(VPUE_win),
                   LANDED_win=mean(LANDED_win), OPERATING_win=mean(OPERATING_PROFIT_2022_win) )


```



# New York Bight (NY) Comparisons


## Aggregate Scallop revenue and Operating Profit by NY 1, 2, and 3 and dropped values. GC fleet
Total revenue and operating profits
```{r}
 

 Inside_NY1_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=sum(DOLLAR_2022_win),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))



 Inside_NY2_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=sum(DOLLAR_2022_win),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))

 Inside_NY3_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=sum(DOLLAR_2022_win),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))




 dropped_values_NY_1_2_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=sum(DOLLAR_2022_win),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))

 dropped_values_NY_2_3_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=sum(DOLLAR_2022_win),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))


```


## Average Winsorized Scallop revenue and Operating Profit by NY 1, 2, and 3 and dropped values. GC fleet

```{r}

 Inside_NY1_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022=mean(DOLLAR_2022),OPERATING_PROFIT_2022_win=mean(OPERATING_PROFIT_2022_win), LANDED_win=mean(LANDED_win),VPUE_win=mean(VPUE_win)  )

 Inside_NY2_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022=mean(DOLLAR_2022),OPERATING_PROFIT_2022_win=mean(OPERATING_PROFIT_2022_win), LANDED_win=mean(LANDED_win),VPUE_win=mean(VPUE_win)  )

 Inside_NY3_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022=mean(DOLLAR_2022),OPERATING_PROFIT_2022_win=mean(OPERATING_PROFIT_2022_win), LANDED_win=mean(LANDED_win),VPUE_win=mean(VPUE_win)  )


 dropped_values_NY_1_2_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022=mean(DOLLAR_2022),OPERATING_PROFIT_2022_win=mean(OPERATING_PROFIT_2022_win), LANDED_win=mean(LANDED_win),VPUE_win=mean(VPUE_win)  )


 dropped_values_NY_2_3_GC %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(), DOLLAR_2022=mean(DOLLAR_2022),OPERATING_PROFIT_2022_win=mean(OPERATING_PROFIT_2022_win), LANDED_win=mean(LANDED_win),VPUE_win=mean(VPUE_win)  )
```



## Aggregate Scallop revenue and Operating Profit by NY 1, 2, and 3 and dropped values. LA fleet
Total revenue and operating profits
```{r}
 

 Inside_NY1_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=sum(DOLLAR_2022_win),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))



 Inside_NY2_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=sum(DOLLAR_2022_win),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))

 Inside_NY3_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=sum(DOLLAR_2022_win),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))




 dropped_values_NY_1_2_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=sum(DOLLAR_2022_win),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))

 dropped_values_NY_2_3_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022_win=sum(DOLLAR_2022_win),OPERATING_PROFIT_2022_win=sum(OPERATING_PROFIT_2022_win), count_PERMITs=n_distinct(PERMIT.y))


```



## Average Winsorized Revenue, Operating Profit, Landed, and VPUE in closures by fleet LA 

```{r}

 Inside_NY1_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022=mean(DOLLAR_2022),OPERATING_PROFIT_2022_win=mean(OPERATING_PROFIT_2022_win), LANDED_win=mean(LANDED_win),VPUE_win=mean(VPUE_win))



 Inside_NY2_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022=mean(DOLLAR_2022),OPERATING_PROFIT_2022_win=mean(OPERATING_PROFIT_2022_win), LANDED_win=mean(LANDED_win),VPUE_win=mean(VPUE_win))

 Inside_NY3_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022=mean(DOLLAR_2022),OPERATING_PROFIT_2022_win=mean(OPERATING_PROFIT_2022_win), LANDED_win=mean(LANDED_win),VPUE_win=mean(VPUE_win))




 dropped_values_NY_1_2_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022=mean(DOLLAR_2022),OPERATING_PROFIT_2022_win=mean(OPERATING_PROFIT_2022_win), LANDED_win=mean(LANDED_win),VPUE_win=mean(VPUE_win))



 dropped_values_NY_2_3_LA %>%
  group_by(fleet,VTR_STATE) %>%
  dplyr::summarise(Trips=n(),DOLLAR_2022=mean(DOLLAR_2022),OPERATING_PROFIT_2022_win=mean(OPERATING_PROFIT_2022_win), LANDED_win=mean(LANDED_win),VPUE_win=mean(VPUE_win))



```






